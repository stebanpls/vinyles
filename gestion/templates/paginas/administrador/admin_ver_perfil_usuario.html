{% extends "plantillas/plantilla_administrador.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/paginas/administrador/usuarios/style_ver_perfil_usuario.css' %}">
{% endblock extra_css %}

{% block titulo %} Administrador - Perfil de Usuario {% endblock titulo %}

{% block contenido %} 
<div class="perfil-container">
    <h2 class="titulo-perfil">Perfil {{ usuario.username }}</h2>

    <div class="perfil-card">
        <div class="perfil-avatar">
            {% if cliente.foto_perfil %}
                <img src="{{ cliente.foto_perfil.url }}" alt="Foto de perfil">
            {% else %}
                <img src="{% static 'images/default_profile.jpg' %}" alt="Avatar por defecto">
            {% endif %}
            <h3>{{ usuario.get_full_name|default:usuario.username }}</h3>
        </div>

        <div class="perfil-info">
            <p><strong>Correo electrónico:</strong> {{ usuario.email }}</p>
            <p><strong>Nombre de usuario:</strong> {{ usuario.username }}</p>
            <p><strong>Número de documento:</strong> {{ cliente.numero_documento|default:"No registrado" }}</p>
            <p><strong>Celular:</strong> {{ cliente.celular|default:"No registrado" }}</p>
            <p><strong>Dirección de residencia:</strong> {{ cliente.direccion_residencia|default:"No registrada" }}</p>
            <p><strong>Fecha de registro:</strong> {{ usuario.date_joined|date:"Y-m-d H:i" }}</p>
            <p><strong>Ultimo inicio de Sesión:</strong> {{ usuario.last_login|date:"Y-m-d H:i" }}</p>
        </div>
    </div>
</div>

<div class="bloq">
    <div class="acciones-usuario">
        <form method="POST" action="{% url 'admin_bloquear_usuario' usuario.id %}" onsubmit="return confirmarBloqueo('{{ usuario.get_full_name|default:usuario.username }}', {{ usuario.is_active|yesno:"true,false" }})">
            {% csrf_token %}
            {% if usuario.is_active %}
                <button type="submit" class="bloquear">Bloquear usuario 🔒</button>
            {% else %}
                <button type="submit" class="bloquear desbloquear">Desbloquear usuario 🔓</button>
            {% endif %}
        </form>

        <a href="{% url 'admin_user_edit' usuario.id %}" class="editar-btn">Editar perfil ✏️</a>

        <form method="POST" action="{% url 'admin_eliminar_usuario' usuario.id %}" onsubmit="return confirmarEliminacion('{{ usuario.get_full_name|default:usuario.username }}')">
            {% csrf_token %}
            <button type="submit" class="eliminar-btn">Eliminar usuario 🗑️</button>
        </form>
    </div>
</div>
{% endblock contenido %}

{% block pie %}
<script>
function confirmarBloqueo(nombreUsuario, estaActivo) {
    if (estaActivo) {
        return confirm(`¿Estás segur@ de que quieres bloquear a ${nombreUsuario}? Esta acción evitará que pueda iniciar sesión.`);
    } else {
        return confirm(`¿Deseas desbloquear a ${nombreUsuario}? Podrá volver a iniciar sesión.`);
    }
}

function confirmarEliminacion(nombreUsuario) {
    return confirm(`¿Estás segur@ de que quieres eliminar a ${nombreUsuario}? Esta acción es permanente.`);
}
</script>
{% endblock pie %}
